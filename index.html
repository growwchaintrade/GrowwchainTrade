/*
Growwchaintrade - TradingView-style single-file React app (App.jsx)

Setup instructions (recommended):
1) Create a new Vite React project:
   npm create vite@latest growwchaintrade -- --template react
   cd growwchaintrade
2) Install dependencies:
   npm install lightweight-charts react-icons
3) Install TailwindCSS (optional but recommended):
   Follow Tailwind install for Vite: https://tailwindcss.com/docs/guides/vite

Usage:
- Replace src/App.jsx with this file contents.
- Ensure Tailwind is configured (or replace classes with your CSS).
- Run: npm install && npm run dev

This single-file app includes:
- Header with logo name "Growwchaintrade"
- Dark/light theme toggle
- Left sidebar (navigation)
- Main area with a TradingView-style candlestick chart using lightweight-charts
- Right sidebar watchlist with mocked real-time updates
- Responsive layout

Feel free to ask for additions: indicators, drawing tools, live data integration (WebSocket/API), login, or exportable chart images.
*/

import React, { useEffect, useRef, useState } from "react";
import { createChart } from "lightweight-charts";
import { FiMoon, FiSun, FiSearch, FiBell } from "react-icons/fi";
import { AiOutlineStar } from "react-icons/ai";

export default function App() {
  const chartContainerRef = useRef(null);
  const chartRef = useRef(null);
  const candleSeriesRef = useRef(null);
  const [theme, setTheme] = useState("dark");
  const [timeframe, setTimeframe] = useState("1D");
  const [watchlist, setWatchlist] = useState([
    { symbol: "BTC/USDT", price: 27950, change: -0.8, id: 1 },
    { symbol: "ETH/USDT", price: 1765, change: 1.4, id: 2 },
    { symbol: "AAPL", price: 172.3, change: -0.3, id: 3 },
  ]);

  // Mock candlestick data (you should replace this with real API data)
  const initialCandles = [
    { time: "2025-09-20", open: 27500, high: 28100, low: 27400, close: 27900 },
    { time: "2025-09-21", open: 27900, high: 28300, low: 27600, close: 28200 },
    { time: "2025-09-22", open: 28200, high: 28500, low: 28000, close: 28150 },
    { time: "2025-09-23", open: 28150, high: 28400, low: 27800, close: 27950 },
    { time: "2025-09-24", open: 27950, high: 28250, low: 27600, close: 27800 },
    { time: "2025-09-25", open: 27800, high: 28050, low: 27450, close: 27950 },
    { time: "2025-09-26", open: 27950, high: 28350, low: 27900, close: 28200 },
  ];

  useEffect(() => {
    // Create chart
    if (chartContainerRef.current) {
      // Clear if exists
      if (chartRef.current) {
        chartRef.current.remove();
        chartRef.current = null;
      }

      const isDark = theme === "dark";
      const chart = createChart(chartContainerRef.current, {
        width: chartContainerRef.current.clientWidth,
        height: 520,
        layout: {
          background: { color: isDark ? "#0f1724" : "#ffffff" },
          textColor: isDark ? "#e6eef6" : "#0b1220",
        },
        grid: {
          vertLines: { color: isDark ? "#1b2430" : "#f0f0f0" },
          horzLines: { color: isDark ? "#1b2430" : "#f0f0f0" },
        },
        crosshair: { mode: 1 },
        rightPriceScale: { borderColor: isDark ? "#2b3946" : "#e6eef6" },
        timeScale: { borderColor: isDark ? "#2b3946" : "#e6eef6" },
      });

      chartRef.current = chart;

      const candleSeries = chart.addCandlestickSeries({
        upColor: "#26a69a",
        downColor: "#ef5350",
        wickUpColor: "#26a69a",
        wickDownColor: "#ef5350",
        borderVisible: false,
      });

      candleSeries.setData(initialCandles);
      candleSeriesRef.current = candleSeries;

      // Handle resize
      const handleResize = () => {
        chart.applyOptions({ width: chartContainerRef.current.clientWidth });
      };
      window.addEventListener("resize", handleResize);

      return () => {
        window.removeEventListener("resize", handleResize);
        chart.remove();
      };
    }
  }, [theme, timeframe]);

  // Mock real-time update for watchlist prices
  useEffect(() => {
    const timer = setInterval(() => {
      setWatchlist((prev) =>
        prev.map((it) => {
          const changePct = (Math.random() - 0.5) * 0.6; // -0.3% to +0.3%
          const newPrice = +(it.price * (1 + changePct / 100)).toFixed(2);
          return { ...it, price: newPrice, change: +(it.change + changePct).toFixed(2) };
        })
      );
    }, 2500);
    return () => clearInterval(timer);
  }, []);

  const toggleTheme = () => setTheme((t) => (t === "dark" ? "light" : "dark"));

  const addToWatchlist = (symbol) => {
    setWatchlist((w) => [...w, { symbol, price: 0, change: 0, id: Date.now() }]);
  };

  return (
    <div className={`min-h-screen ${theme === "dark" ? "bg-[#071322] text-[#e6eef6]" : "bg-white text-[#0b1220]"}`}>
      {/* Header */}
      <header className="flex items-center justify-between px-4 py-3 border-b" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
        <div className="flex items-center gap-3">
          <div className="flex items-center gap-2">
            <div className="bg-gradient-to-r from-green-400 to-blue-500 rounded-md p-2 text-white font-bold">G</div>
            <div className="font-semibold text-lg">Growwchaintrade</div>
          </div>
          <div className="hidden md:flex items-center bg-transparent rounded px-2 py-1 border" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
            <FiSearch />
            <input className={`ml-2 bg-transparent outline-none ${theme === "dark" ? "placeholder-[#9fb0c4]" : "placeholder-[#6b7280]"}`} placeholder="Search symbol, e.g. BTC/USDT" />
          </div>
        </div>

        <div className="flex items-center gap-4">
          <button className="hidden md:flex items-center gap-2 px-3 py-1 rounded border" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
            <AiOutlineStar /> Watchlist
          </button>
          <button onClick={toggleTheme} className="p-2 rounded hover:opacity-90 border" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
            {theme === "dark" ? <FiSun /> : <FiMoon />}
          </button>
          <button className="p-2 rounded border" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
            <FiBell />
          </button>
        </div>
      </header>

      <div className="flex">
        {/* Left Sidebar */}
        <aside className="w-20 md:w-56 border-r px-2 py-4 hidden md:block" style={{ borderColor: theme === "dark" ? "#162533" : "#eef2f7" }}>
          <nav className="flex flex-col gap-3">
            <button className="text-left px-3 py-2 rounded hover:bg-opacity-5">Dashboard</button>
            <button className="text-left px-3 py-2 rounded hover:bg-opacity-5">Markets</button>
            <button className="text-left px-3 py-2 rounded hover:bg-opacity-5">Watchlist</button>
            <button className="text-left px-3 py-2 rounded hover:bg-opacity-5">Portfolio</button>
            <button className="text-left px-3 py-2 rounded hover:bg-opacity-5">News</button>
          </nav>

          <div className="mt-6 px-3">
            <div className="text-sm mb-2">Timeframe</div>
            <div className="flex gap-2">
              {["1m", "5m", "1h", "4h", "1D"].map((tf) => (
                <button key={tf} onClick={() => setTimeframe(tf)} className={`px-2 py-1 rounded ${timeframe === tf ? "bg-[#0ea5a0] text-white" : "border"}`}>
                  {tf}
                </button>
              ))}
            </div>
          </div>
        </aside>

        {/* Main content */}
        <main className="flex-1 p-4">
          <div className="rounded-lg overflow-hidden shadow-sm">
            <div ref={chartContainerRef} className="w-full bg-transparent"></div>

            {/* Toolbar below the chart */}
            <div className="flex items-center justify-between px-4 py-3 border-t" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
              <div className="flex items-center gap-3">
                <div className="font-semibold">BTC/USDT</div>
                <div className="text-sm text-gray-400">Last: 27,950 • -0.8%</div>
              </div>
              <div className="flex items-center gap-2">
                <button className="px-3 py-1 border rounded">Indicators</button>
                <button className="px-3 py-1 border rounded">Templates</button>
                <button className="px-3 py-1 bg-[#0ea5a0] text-white rounded">Buy</button>
                <button className="px-3 py-1 bg-[#ef5350] text-white rounded">Sell</button>
              </div>
            </div>
          </div>

          {/* Below main area: small market cards */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div className="p-3 rounded border" style={{ borderColor: theme === "dark" ? "#162533" : "#eef2f7" }}>
              <div className="text-sm">Top Gainers</div>
              <ul className="mt-2">
                <li>ETH • +3.4%</li>
                <li>BNB • +2.1%</li>
                <li>ADA • +1.9%</li>
              </ul>
            </div>

            <div className="p-3 rounded border" style={{ borderColor: theme === "dark" ? "#162533" : "#eef2f7" }}>
              <div className="text-sm">Top Losers</div>
              <ul className="mt-2">
                <li>XRP • -1.1%</li>
                <li>DOGE • -0.8%</li>
              </ul>
            </div>

            <div className="p-3 rounded border" style={{ borderColor: theme === "dark" ? "#162533" : "#eef2f7" }}>
              <div className="text-sm">Market News</div>
              <div className="mt-2 text-sm">No news loaded. Connect a news API to show headlines.</div>
            </div>
          </div>
        </main>

        {/* Right Sidebar */}
        <aside className="w-80 border-l px-3 py-4 hidden lg:block" style={{ borderColor: theme === "dark" ? "#162533" : "#eef2f7" }}>
          <div className="flex items-center justify-between mb-3">
            <div className="font-semibold">Watchlist</div>
            <button className="text-sm">Add</button>
          </div>

          <div className="flex flex-col gap-3">
            {watchlist.map((w) => (
              <div key={w.id} className="flex items-center justify-between p-2 rounded border" style={{ borderColor: theme === "dark" ? "#0f2433" : "#f1f5f9" }}>
                <div>
                  <div className="font-medium">{w.symbol}</div>
                  <div className="text-xs">{w.price}</div>
                </div>
                <div className={`text-sm ${w.change >= 0 ? "text-green-400" : "text-red-400"}`}>{w.change}%</div>
              </div>
            ))}
          </div>

          <div className="mt-6">
            <div className="text-sm mb-2">Quick Add</div>
            <div className="flex gap-2">
              <button onClick={() => addToWatchlist("SOL/USDT")} className="px-2 py-1 border rounded">SOL</button>
              <button onClick={() => addToWatchlist("ADA/USDT")} className="px-2 py-1 border rounded">ADA</button>
              <button onClick={() => addToWatchlist("XRP/USDT")} className="px-2 py-1 border rounded">XRP</button>
            </div>
          </div>
        </aside>
      </div>

      {/* Footer */}
      <footer className="px-4 py-3 border-t text-sm" style={{ borderColor: theme === "dark" ? "#203244" : "#eef2f7" }}>
        <div className="max-w-7xl mx-auto flex items-center justify-between">
          <div>© {new Date().getFullYear()} Growwchaintrade</div>
          <div className="hidden sm:flex gap-4">
            <a>Contact</a>
            <a>Privacy</a>
            <a>Terms</a>
          </div>
        </div>
      </footer>
    </div>
  );
}
